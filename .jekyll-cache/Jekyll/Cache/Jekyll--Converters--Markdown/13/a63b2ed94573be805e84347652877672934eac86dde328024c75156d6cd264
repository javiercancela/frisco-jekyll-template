I"»<p><strong>Introducci√≥n</strong></p>

<p>La especificaci√≥n <a href="http://jcp.org/en/jsr/detail?id=179" title="Location API for J2ME"><em>JSR-179 Location API for J2ME</em></a> pone a nuestra disposici√≥n una serie de clases que permiten acceder desde Java a informaci√≥n relacionada con la posici√≥n y el movimiento de nuestro dispositivo.</p>

<p>Lo que vamos a ver es una descripci√≥n b√°sica de estas clases. Para probarlo necesitaremos un m√≥vil que implemente al especificaci√≥n JSR-179, como la mayor√≠a de los Nokia o BlackBerry modernos.</p>

<p>Hay que tener en cuenta que no es necesario que el m√≥vil disponga de GPS. La <em>Location API</em> nos aisla del origen de los datos, que puede ser un GPS o puede ser un servicio de pago proporcionado por la operadora. Debido a esto la API nos ofrece una serie de par√°metros para filtrar qu√© tipo de servicios nos interesan de aquellos disponibles.</p>

<p>**Fuentes de localizaci√≥n</p>

<p>**</p>

<p>En lo referente a localizaci√≥n, existen habitualmente tres fuentes posibles de datos:</p>

<p>‚Äì GPS: nuestro m√≥vil incorpora un GPS, o est√° conectado a uno (habitualmente a trav√©s de Bluetooth).</p>

<p>‚Äì Assisted GPS: adem√°s de un GPS, nuestro m√≥vil tiene acceso a informaci√≥n de localizaci√≥n que evita que el GPS pase hasta varios minutos obteniendo esa informaci√≥n de los sat√©lites antes de dar la primera posici√≥n. Para ello es necesario un servicio espec√≠fico ofrecido por algunas operadoras, habitualmente de pago.</p>

<p>‚Äì Cell Id: el m√≥vil no tiene acceso a un GPS, pero s√≠ a un servicio que le proporciona informaci√≥n basada en el identificador de la c√©lula telef√≥nica en la que se encuentra. Tambi√©n suele ser un servicio de pago por parte de las operadoras.</p>

<p>La <em>Location API</em> est√° preparada para el dispositivo tenga acceso a todo tipo de <em>Location Providers</em> o Proveedores de Localizaci√≥n, que es como se denominan a estas fuentes de datos. Para poder seleccionar entre las opciones actuales y futuras existe una clase que nos permite definir una serie de criterios que deba cumplir el proveedor que nos interese.</p>

<p><strong>Estableciendo criterios</strong></p>

<p>La clase <code class="language-plaintext highlighter-rouge">javax.microedition.location.Criteria</code> proporciona funciones que nos van a permitir filtrar los proveedores de localizaci√≥n disponibles. Veamos qu√© podemos definir en esta clase:</p>

<ul>
  <li>
    <p>La precisi√≥n horizontal y vertical.</p>

    <p>Se establece mediante los m√©todos <code class="language-plaintext highlighter-rouge">setHorizontalAccuracy</code> y <code class="language-plaintext highlighter-rouge">setVerticalAccuracy</code>. La precisi√≥n de los datos depende de su origen. As√≠, si indicamos una precisi√≥n de 50 metros excluiremos los datos provenientes de localizaci√≥n por celda telef√≥nica, que suelen tener precisiones de cientos de metros, pero aceptaremos los datos del GPS, con precisiones t√≠picas de pocos metros.</p>
  </li>
  <li>
    <p>El permiso para obtener datos a cambio de un precio.</p>

    <p>Mediante el m√©todo <code class="language-plaintext highlighter-rouge">setCostAllowed(false)</code> (el valor por defecto es true) impedimos que nos cobren por obtener datos de localizaci√≥n. Esto excluye habitualmente el A-GPS y la localizaci√≥n por celda telef√≥nica, que necesitan comunicaci√≥n con la red telef√≥nica para obtener la informaci√≥n, adem√°s de un posible sobrecoste por el servicio.</p>
  </li>
  <li>
    <p>El nivel de consumo de bater√≠a.</p>

    <p>A trav√©s del m√©todo <code class="language-plaintext highlighter-rouge">setPreferredPowerConsumption</code> podemos indicar si permitiremos un nivel de consumo bajo, medio o alto. Hay que tener en cuenta que es el fabricante del dispositivo quien decide qu√© es alto, medio o bajo, pero probablemente el uso de un dispositivo GPS interno o bluetooth tendr√° un consumo medio o alto.</p>
  </li>
  <li>
    <p>Otros criterios.</p>

    <p>El tiempo de respuesta, la velocidad o informaci√≥n relativa a la direcci√≥n postal. Para una descripci√≥n m√°s extensa, v√©ase la <a href="http://www-users.cs.umn.edu/~czhou/docs/jsr179/lapi/javax/microedition/location/Criteria.html" title="Class Criteria">referencia de la clase <code class="language-plaintext highlighter-rouge">Criteria</code></a>.</p>
  </li>
</ul>

<p><strong>Accediendo al GPS</strong></p>

<p>Una vez definidos los criterios, obtendremos una referencia al proveedor de contenidos. La clase <code class="language-plaintext highlighter-rouge">LocationProvider</code> implementa un m√©todo est√°tico <a href="http://www-users.cs.umn.edu/~czhou/docs/jsr179/lapi/javax/microedition/location/LocationProvider.html#getInstance(javax.microedition.location.Criteria)" title="getInstance"><code class="language-plaintext highlighter-rouge">getInstance(Criteria criteria)</code></a> que devuelve un proveedor que se adapte a los criterios que hemos indicado. Si ninguno de los proveedores disponibles encaja en los criterios indicados, el m√©todo devolver√° <code class="language-plaintext highlighter-rouge">null</code>. En caso de que no exista ning√∫n proveedor de localizaci√≥n disponible se lanzar√° una <code class="language-plaintext highlighter-rouge">LocationException</code>. Es posible llamar a <code class="language-plaintext highlighter-rouge">getInstance</code> pasando <code class="language-plaintext highlighter-rouge">null</code> como par√°metro: de esta forma se especifican los par√°metros menos restrictivos para la selecci√≥n.</p>

<p>Utilizaremos la instancia obtenida de <code class="language-plaintext highlighter-rouge">LocationProvider</code> para obtener la posici√≥n mediante el m√©todo <a href="http://www-users.cs.umn.edu/~czhou/docs/jsr179/lapi/javax/microedition/location/LocationProvider.html#getLocation(int)" title="getLocation"><code class="language-plaintext highlighter-rouge">getLocation</code></a>. En el podemos especificar un <em>timeout</em>, o tiempo que queremos que espere el sistema para obtener una posici√≥n. Una vez obtenida dispondremos de un objeto <code class="language-plaintext highlighter-rouge">Location</code> que contendr√°, entre otras cosas, las coordenadas de nuestra ubicaci√≥n.</p>

<p><strong>Un ejemplo sencillo</strong></p>

<p>Juntemos todo en un ejemplo muy sencillo, s√≥lo √∫til para hacerse una idea del c√≥digo descrito:</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">// Establecemos los criterios. Queremos s√≥lo un GPS interno o Bluetooth&lt;br /&gt;
Criteria criteria = new Criteria();&lt;br /&gt;
criteria.setCostAllowed(false);&lt;br /&gt;
// Como el valor por defecto de los siguientes par√°metros&lt;br /&gt;
// es NO_REQUIREMENT, las siguientes l√≠neas no son necesarias&lt;br /&gt;
criteria.setHorizontalAccuracy(NO_REQUIREMENT);&lt;br /&gt;
criteria.setVerticalAccuracy(NO_REQUIREMENT);&lt;br /&gt;
criteria.setPreferredPowerConsumption(NO_REQUIREMENT);</code></p>
</blockquote>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">&lt;br /&gt;
// Aqu√≠ falta capturar la posible excepci√≥n y verificar que el&lt;br /&gt;
// valor devuelto no es null&lt;br /&gt;
LocationProvider lp = LocationProvider.getInstance(criteria);&lt;br /&gt;
// Con -1 indicamos el timeout por defecto&lt;br /&gt;
Location location = lp.getLocation(-1);</code></p>

  <p><code class="language-plaintext highlighter-rouge">Coordinates coordinates = location.getQualifiedCoordinates();&lt;br /&gt;
System.out.println("Latitud: " + coordinates.getLatitude());&lt;br /&gt;
System.out.println("Longitud: " + coordinates.getLongitude());</code></p>
</blockquote>

<p><strong>Referencias</strong>:</p>

<p><a href="http://www-users.cs.umn.edu/~czhou/docs/jsr179/lapi/" title="JSR179 Location API for J2ME">Documentaci√≥n on-line de la Location API</a></p>
:ET