<!DOCTYPE html>

<html lang="en">

<head>
    <script type="text/javascript">
        var host = "www.javiercancela.com";
        if ((host == window.location.host) && (window.location.protocol != "https:"))
            window.location.protocol = "https";
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Jekyll v4.2.0">

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300|Rubik:300">
    <link rel="stylesheet" href="/css/screen.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff"> <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Cómo montar un blog sin (casi) cookies | Página de Javier Cancela</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Cómo montar un blog sin (casi) cookies" />
<meta name="author" content="Javier Cancela" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Para cumplir la GRDP hay que añadir un aviso de cookies… o no usar cookies" />
<meta property="og:description" content="Para cumplir la GRDP hay que añadir un aviso de cookies… o no usar cookies" />
<link rel="canonical" href="https://www.javiercancela.com/2021/01/04/blog-sin-cookies/" />
<meta property="og:url" content="https://www.javiercancela.com/2021/01/04/blog-sin-cookies/" />
<meta property="og:site_name" content="Página de Javier Cancela" />
<meta property="og:image" content="https://www.javiercancela.com/images/cookies.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-04T21:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.javiercancela.com/images/cookies.jpg" />
<meta property="twitter:title" content="Cómo montar un blog sin (casi) cookies" />
<script type="application/ld+json">
{"dateModified":"2021-01-04T21:00:00+01:00","datePublished":"2021-01-04T21:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.javiercancela.com/2021/01/04/blog-sin-cookies/"},"@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.javiercancela.com/siteicon.png"},"name":"Javier Cancela"},"url":"https://www.javiercancela.com/2021/01/04/blog-sin-cookies/","author":{"@type":"Person","name":"Javier Cancela"},"image":"https://www.javiercancela.com/images/cookies.jpg","description":"Para cumplir la GRDP hay que añadir un aviso de cookies… o no usar cookies","headline":"Cómo montar un blog sin (casi) cookies","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
  <script>
    function initFingerprintJS() {
        FingerprintJS.load().then(fp => {
            // The FingerprintJS agent is ready.
            // Get a visitor identifier when you'd like to.
            fp.get().then(result => {
                // This is the visitor identifier:
                const visitorId = result.visitorId;


                (function(i, s, o, g, r, a, m) {
                    i['GoogleAnalyticsObject'] = r;
                    i[r] = i[r] || function() {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
                    a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                    a.async = 1;
                    a.src = g;
                    m.parentNode.insertBefore(a, m)
                })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

                ga('create', 'UA-58458863-1', {
                    'storage': 'none',
                    'clientId': visitorId
                });
                ga('set', 'anonymizeIp', true);
                ga('send', 'pageview');
            });
        });
    }
</script>
<script async src="//cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js" onload="initFingerprintJS()"></script> 
</head>

<body>
    <header id="mainHeader">
        <div class="container">
            <div class="company-name">
                <a href="/">
                    <span class="dark-logo"><img width="104" height="38" src="/images/logo/dark.png" alt="dark frisco logo"></span>
                    <span class="light-logo"><img width="104" height="38" src="/images/logo/light.png" alt="light frisco logo"></span>
                </a>
            </div>
            <nav>
	<a class="nav-toggle" id="open-nav" href="#">&#9776;</a>
	
		
		

		
		<a href="/" class="" >Blog</a>
	
		
		

		
		<a href="/archivo/" class="" >Archivo</a>
	
		
		

		
		<a href="/sobre-mi/" class="" >Sobre mí</a>
	
</nav>

        </div>
    </header>

    <section class="hero" style="background-image: url(/images/cookies.jpg)">
	<div class="inner-hero text-container">
		<div class="hero-text-container">
			<h1>Cómo montar un blog sin (casi) cookies</h1>
			<p class="subtext"></p>
		</div>
	</div>
</section>

<section>
    <div class="blog-post text-container">
        <p class="post-details">
	
		
		<span class="blog-filter">
			<a href="/category/blog/">Blog</a>
		</span>
	
	
	
	
	
	
	
	<span class="post-date">04 de enero de 2021</span>
</p>


        <div class="post-content">
            <h1 id="cómo-eliminar-las-cookies-del-blog">Cómo eliminar las cookies del blog</h1>

<p>No creo que la <a href="https://www.aepd.es/es">Agencia Española de Protección de Datos</a> esté muy pendiente de un blog con 500 visitas al mes alojado en USA, pero aun así hay que tener las cosas en regla.</p>

<p>La Agencia tiene una práctica <a href="https://www.aepd.es/sites/default/files/2020-07/guia-cookies.pdf">guía de uso de cookies</a> donde se explica en detalle todo lo que hay que saber para cumplir con la legislación. De todo lo que hay que saber sobre este tema lo más importante es: <strong>si no necesitas cookies, no las uses.</strong></p>

<p>Las cookies son pequeños archivos que el navegador almacena y asocia a un dominio. Podemos ver qué cookies se almacenan en cada página desde las herramientas del navegador. Por ejemplo, en Chrome pulsamos F12 y vamos a la pestaña Application:</p>

<div style="text-align:center">
    <figure>
        <img alt="Cookies en Chrome." src="/images/cookies-chrome.jpg" />
        <figcaption>Cookies en Chrome.</figcaption>
    </figure>
</div>

<h2 id="qué-cookies-tenía">Qué cookies tenía</h2>

<p>Pues únicamente tres: la de <a href="https://analytics.google.com/analytics/web/">Google Analytics</a>, la del sistema de comentarios, <a href="https://disqus.com/">Disqus</a>, y la de <a href="https://www.cloudflare.com/es-es/">CloudFlare</a>.</p>

<h3 id="cómo-quitar-la-cookie-de-disqus">Cómo quitar la cookie de Disqus</h3>

<p>Quitando Disqus.</p>

<p>Lo de los comentarios ya no se lleva, y menos en un blog que nadie visita. Si alguien quiere contactar conmigo, por <a href="mailto:javier.cancela@hey.com">email</a>, <a href="https://twitter.com/javier_cancela_">Twitter</a> o incluso <a href="https://www.linkedin.com/in/javiercancela">LinkedIn</a>.</p>

<h3 id="cómo-quitar-la-cookie-cloudflare">Cómo quitar la cookie CloudFlare</h3>

<p><a href="https://blog.cloudflare.com/deprecating-cfduid-cookie/">Esperando a que desaparezca</a>. No es una web que comprometa la privacidad del usuario, pero como explican en el post el nombre queda feo.</p>

<p>¿Que por qué hay una cookie de CloudFlare? Porque es lo que usa Git Hub de proxy inverso, así que en realidad es a CloudFlare a quien llegan inicialmente las peticiones a este blog. Como ocurre con <a href="https://w3techs.com/technologies/details/cn-cloudflare">más del 15% de internet</a>.</p>

<div style="text-align:center">
    <figure>
        <a title="H2g2bob, CC0, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Reverse_proxy_h2g2bob.svg">
          <img alt="Reverse proxy h2g2bob" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Reverse_proxy_h2g2bob.svg/256px-Reverse_proxy_h2g2bob.svg.png" /></a>

        <figcaption>Imagen random de un proxy inverso sacada de la Wikipedia.</figcaption>
    </figure>
</div>

<h3 id="cómo-quitar-la-cookie-de-google-analytics">Cómo quitar la cookie de Google Analytics</h3>

<p>En principio es sencillo. El código para incluir Analytics es algo así:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="c">&lt;!--</span> <span class="nx">Google</span> <span class="nx">Analytics</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">){</span><span class="nx">i</span><span class="p">[</span><span class="dl">'</span><span class="s1">GoogleAnalyticsObject</span><span class="dl">'</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">||</span><span class="kd">function</span><span class="p">(){</span>
    <span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
    <span class="nx">m</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">o</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="k">async</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">g</span><span class="p">;</span><span class="nx">m</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">)</span>
    <span class="p">})(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">https://www.google-analytics.com/analytics.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">ga</span><span class="dl">'</span><span class="p">);</span>

    <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">UA-XXXXX-Y</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">send</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">pageview</span><span class="dl">'</span><span class="p">);</span>
    <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>    <span class="c">&lt;!--</span> <span class="nx">End</span> <span class="nx">Google</span> <span class="nx">Analytics</span> <span class="o">--&gt;</span>
</code></pre></div></div>

<p>Si queremos deshabilitar las cookies basta con sustituir esto:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">UA-XXXXX-Y</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>
<p>por esto:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">UA-XXXXX-Y</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">storage</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span>
    <span class="p">});</span>
</code></pre></div></div>

<p>Problema: perdemos cualquier tipo de seguimiento del cliente. Si yo accedo a una página con esta configuración y hago click en un enlace Google Analytics interpretará ambos accesos como independientes, con lo que no podremos saber cómo navegan los usuarios por nuestro sitio, cuánto tiempo están, etc…</p>

<p>Una solución de compromiso la encontré en <a href="https://helgeklein.com/blog/2020/06/google-analytics-cookieless-tracking-without-gdpr-consent/">este artículo</a>. La idea es no delegar en GA la generación de un id que se almacene temporalmente en el navegador, sino proporcionar un id que podamos generar de forma más o menos individual para cada visitante de nuestra página. El código propuesto en el artículo es este:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cyrb53</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">seed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nx">h1</span> <span class="o">=</span> <span class="mh">0xdeadbeef</span> <span class="o">^</span> <span class="nx">seed</span><span class="p">,</span>
      <span class="nx">h2</span> <span class="o">=</span> <span class="mh">0x41c6ce57</span> <span class="o">^</span> <span class="nx">seed</span><span class="p">;</span>
   <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ch</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ch</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="nx">h1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">imul</span><span class="p">(</span><span class="nx">h1</span> <span class="o">^</span> <span class="nx">ch</span><span class="p">,</span> <span class="mi">2654435761</span><span class="p">);</span>
      <span class="nx">h2</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">imul</span><span class="p">(</span><span class="nx">h2</span> <span class="o">^</span> <span class="nx">ch</span><span class="p">,</span> <span class="mi">1597334677</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="nx">h1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">imul</span><span class="p">(</span><span class="nx">h1</span> <span class="o">^</span> <span class="nx">h1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">2246822507</span><span class="p">)</span> <span class="o">^</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">imul</span><span class="p">(</span><span class="nx">h2</span> <span class="o">^</span> <span class="nx">h2</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">3266489909</span><span class="p">);</span>
   <span class="nx">h2</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">imul</span><span class="p">(</span><span class="nx">h2</span> <span class="o">^</span> <span class="nx">h2</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">2246822507</span><span class="p">)</span> <span class="o">^</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">imul</span><span class="p">(</span><span class="nx">h1</span> <span class="o">^</span> <span class="nx">h1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">3266489909</span><span class="p">);</span>
   <span class="k">return</span> <span class="mi">4294967296</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2097151</span> <span class="o">&amp;</span> <span class="nx">h2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">h1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">clientIP</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">{$_SERVER['REMOTE_ADDR']}</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">validityInterval</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="mi">4</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">clientIDSource</span> <span class="o">=</span> <span class="nx">clientIP</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">;</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">;</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">;</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">language</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">validityInterval</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">clientIDHashed</span> <span class="o">=</span> <span class="nx">cyrb53</span><span class="p">(</span><span class="nx">clientIDSource</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">o</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">){</span><span class="nx">i</span><span class="p">[</span><span class="dl">'</span><span class="s1">GoogleAnalyticsObject</span><span class="dl">'</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">||</span><span class="kd">function</span><span class="p">(){</span>
<span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span><span class="o">||</span><span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">l</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
<span class="nx">m</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">o</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="k">async</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">g</span><span class="p">;</span><span class="nx">m</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">m</span><span class="p">)</span>
<span class="p">})(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">//www.google-analytics.com/analytics.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">ga</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">YOUR-GA-TRACKING-CODE</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
   <span class="dl">'</span><span class="s1">storage</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
   <span class="dl">'</span><span class="s1">clientId</span><span class="dl">'</span><span class="p">:</span> <span class="nx">clientIDHashed</span>
<span class="p">});</span>
<span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">set</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">anonymizeIp</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">send</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">pageview</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>Lo que hace este código es generar un hash a partir de la ip del cliente, el user agent, el idioma del navegador y el número de bloques de 4 días desde enero de 1970 (<code class="language-plaintext highlighter-rouge">new Date() / 1000 / 3600 / 24 / 4</code>), de forma que el hash cambie cada cuatro días.</p>

<p>El problema de este código es que el parámetro más importante es la IP, que desde mi blog no puedo obtener porque no ejecuta código en el servidor. Como alternativa, modifiqué el código para usar un <em>fingerprint</em> basado en la librería <a href="https://github.com/fingerprintjs/fingerprintjs">fingerprintjs</a>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">function</span> <span class="nx">initFingerprintJS</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">FingerprintJS</span><span class="p">.</span><span class="nx">load</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">fp</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// The FingerprintJS agent is ready.</span>
            <span class="c1">// Get a visitor identifier when you'd like to.</span>
            <span class="nx">fp</span><span class="p">.</span><span class="kd">get</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="c1">// This is the visitor identifier:</span>
                <span class="kd">const</span> <span class="nx">visitorId</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">visitorId</span><span class="p">;</span>


                <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">i</span><span class="p">[</span><span class="dl">'</span><span class="s1">GoogleAnalyticsObject</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
                    <span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span> <span class="o">||</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span> <span class="o">=</span> <span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">q</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span>
                    <span class="p">},</span> <span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">].</span><span class="nx">l</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
                    <span class="nx">a</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span>
                        <span class="nx">m</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">o</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
                    <span class="nx">a</span><span class="p">.</span><span class="k">async</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nx">a</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">g</span><span class="p">;</span>
                    <span class="nx">m</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>
                <span class="p">})(</span><span class="nb">window</span><span class="p">,</span> <span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">//www.google-analytics.com/analytics.js</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ga</span><span class="dl">'</span><span class="p">);</span>

                <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">UA-58458863-1</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="dl">'</span><span class="s1">storage</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
                    <span class="dl">'</span><span class="s1">clientId</span><span class="dl">'</span><span class="p">:</span> <span class="nx">visitorId</span>
                <span class="p">});</span>
                <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">set</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">anonymizeIp</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="nx">ga</span><span class="p">(</span><span class="dl">'</span><span class="s1">send</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">pageview</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="k">async</span> <span class="nx">src</span><span class="o">=</span><span class="dl">"</span><span class="s2">//cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js</span><span class="dl">"</span> <span class="nx">onload</span><span class="o">=</span><span class="dl">"</span><span class="s2">initFingerprintJS()</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>
<p>La idea es la misma, pero para compensar la falta de IP se usan otros parámetros como la resolución del navegador, los plugins instalados y, en general, cualquier dato que el navegador proporcione que pueda servir para afinar la identificación.</p>

<p>El resultado de este script no es óptimo, y habrá un porcentaje de falsos positivos (usuarios distintos con el mismo id) y falsos negativos (el mismo usuario que aparece como dos distintos tras hacer algún cambio, como mover el navegador), pero es suficiente para tener una idea aproximada de cómo está funcionando el blog sin perjudicar la privacidad de los usuarios ni incumplir la ley.</p>



            <div class="blog-navigation">
                
                <a class="prev" href="/2018/03/12/varios/">&laquo; Varios</a>  
            </div>
        </div>
    </div>
</section>


    <footer>
        <div class="container">
            <p class="editor-link"><a href="cloudcannon:collections/_data/footer.yml" class="btn"><strong>&#9998;</strong> Edit footer</a></p>
            <ul class="footer-right-links">
                
                <li>
                    <a target="_blank"  href="https://twitter.com/javier_cancela_" class="twitter-icon" >
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" /></svg>
	
								
							</a>
                </li>
                
                <li>
                    <a target="_blank"  href="https://www.linkedin.com/in/javiercancela" class="linkedin-icon" >
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19,19H16V13.7A1.5,1.5 0 0,0 14.5,12.2A1.5,1.5 0 0,0 13,13.7V19H10V10H13V11.2C13.5,10.36 14.59,9.8 15.5,9.8A3.5,3.5 0 0,1 19,13.3M6.5,8.31C5.5,8.31 4.69,7.5 4.69,6.5A1.81,1.81 0 0,1 6.5,4.69C7.5,4.69 8.31,5.5 8.31,6.5A1.81,1.81 0 0,1 6.5,8.31M8,19H5V10H8M20,2H4C2.89,2 2,2.89 2,4V20A2,2 0 0,0 4,22H20A2,2 0 0,0 22,20V4C22,2.89 21.1,2 20,2Z" /></svg>
	
								
							</a>
                </li>
                
                <li>
                    <a  href="/feed.xml" class="rss-icon" >
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
	
								
							</a>
                </li>
                
                <li>
                    <a  href="mailto:javier.cancela@hey.com" class="email-icon" >
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>

								
							</a>
                </li>
                
            </ul>
            <p class="copyright">
                <a href="https://cloudcannon.com/">
						Template by CloudCannon
					</a>
            </p>
        </div>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/prism.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript">
        MathJax.Hub.Config({
            config: ["MMLorHTML.js"],
            extensions: ["tex2jax.js"],
            jax: ["input/TeX"],
            displayAlign: "center",
            tex2jax: {
                inlineMath: [
                    ['$', '$'],
                    ["\\(", "\\)"]
                ],
                displayMath: [
                    ['$$', '$$'],
                    ["\\[", "\\]"]
                ],
                processEscapes: false
            },
            TeX: {
                extensions: ["AMSmath.js", "AMSsymbols.js"],
                TagSide: "right",
                TagIndent: ".8em",
                MultLineWidth: "85%",
                equationNumbers: {
                    autoNumber: "AMS",
                },
                unicode: {
                    fonts: "STIXGeneral,'Arial Unicode MS'"
                }
            },
            showProcessingMessages: false
        });
    </script>
</body>

</html>